<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>文化敏感型语义对齐翻译系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container { max-width: 1000px; margin: 30px auto; }
        .card { box-shadow: 0 4px 20px rgba(0,0,0,0.1); border-radius: 12px; margin-bottom: 20px; }
        .step-card { background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0; }
        .irony-tag { background: #ff7f50; color: white; padding: 2px 8px; border-radius: 4px; }
        .offensive-tag { background: #dc3545; color: white; padding: 2px 8px; border-radius: 4px; }
        .detected-culture { color: #0d6efd; font-weight: 500; margin-top: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- 输入卡片 -->
        <div class="card p-5">
            <h2 class="text-center mb-5">文化敏感型语义对齐翻译系统</h2>
            
            <div class="form-group">
                <label for="textInput" class="form-label fs-5">输入待处理文本</label>
                <textarea id="textInput" class="form-control" rows="4" placeholder="例如：你真厉害，居然迟到了半小时" required></textarea>
            </div>
            
            <div class="row g-4">
                <div class="col-md-6">
                    <label for="speakerCulture" class="form-label fs-5">说话人语言</label>
                    <select id="speakerCulture" class="form-select form-select-lg">
                        <option value="auto">自动检测（根据输入文本）</option>
                        <option value="中国">中文</option>
                        <option value="日本">日语</option>
                        <option value="韩国">韩语</option>
                        <option value="美国">英语</option>
                        <option value="德国">德语</option>
                    </select>
                    <!-- 展示自动检测后的说话人国家 -->
                    <div id="detectedCultureDisplay" class="detected-culture"></div>
                </div>
                <div class="col-md-6">
                    <label for="targetLang" class="form-label fs-5">目标翻译语言</label>
                    <select id="targetLang" class="form-select form-select-lg">
                        <option value="zh">中文</option>
                        <option value="en">英语</option>
                        <option value="ja">日语</option>
                        <option value="ko">韩语</option>
                        <option value="de">德语</option>
                    </select>
                </div>
            </div>
            
            <button id="processBtn" class="btn btn-primary btn-lg w-100 mt-5">语义适配+翻译+建议</button>
        </div>

        <!-- 语义流程展示卡片 -->
        <div class="card p-5">
            <h4 class="card-title mb-4">文化语义适配流程</h4>
            <div class="step-card">
                <p><strong>1. 原始输入文本：</strong><span id="originalText">-</span></p>
            </div>
            <div class="step-card">
                <p><strong>2. 文化语义重写（基于说话人语境）：</strong><span id="rewrittenText" class="text-primary">-</span></p>
            </div>
            <div class="step-card">
                <p><strong>3. 语境适配翻译结果：</strong><span id="translatedText" class="text-success">-</span></p>
            </div>
        </div>

        <!-- 分析建议卡片 -->
        <div class="card p-5">
            <h4 class="card-title mb-4">跨文化分析建议</h4>
            <div class="row g-3">
                <div class="col-md-6">
                    <p><strong>说话人国家：</strong><span id="displayedSpeakerCulture" class="badge bg-info">-</span></p>
                    <p><strong>语境类型：</strong><span id="contextType" class="badge bg-secondary">-</span></p>
                    <p><strong>语义类型：</strong><span id="semanticType" class="irony-tag">-</span></p>
                </div>
                <div class="col-md-6">
                    <p><strong>文化适配建议：</strong><span id="cultureSuggest">-</span></p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('processBtn').addEventListener('click', async function() {
            const text = document.getElementById('textInput').value.trim();
            const speakerSelect = document.getElementById('speakerCulture');
            const speaker = speakerSelect.value;
            const targetLang = document.getElementById('targetLang').value;

            if (!text) { alert('请输入文本！'); return; }

            try {
                const response = await fetch('http://127.0.0.1:5000/culture_semantic_adapt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, speaker_culture: speaker, target_lang: targetLang })
                });
                const result = await response.json();

                // 1. 展示自动检测后的说话人国家
                if (speaker === "auto") {
                    document.getElementById('detectedCultureDisplay').textContent = `自动检测结果：${result.detected_speaker_culture}`;
                } else {
                    document.getElementById('detectedCultureDisplay').textContent = "";
                }

                // 2. 渲染语义流程
                document.getElementById('originalText').textContent = text;
                document.getElementById('rewrittenText').textContent = result.rewritten_text;
                document.getElementById('translatedText').textContent = result.translated_text;

                // 3. 渲染分析建议
                document.getElementById('displayedSpeakerCulture').textContent = result.detected_speaker_culture;
                document.getElementById('contextType').textContent = result.context_type;
                document.getElementById('semanticType').textContent = result.semantic_type;
                document.getElementById('cultureSuggest').textContent = result.culture_suggest;
            } catch (e) {
                alert(`操作失败：${e.message}`);
            }
        });
    </script>
</body>
</html>